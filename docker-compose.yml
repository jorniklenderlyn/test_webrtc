services:
  webrtc-app:
    build: .
    network_mode: "host"
    ports:
      - "8000:8000"   # HTTPS port (not 8080)
    volumes:
      - ./certs:/app/certs:ro          # Mount certs
      - ./index.html:/app/index.html
      - ./client.js:/app/client.js
      - ./demo-instruct.wav:/app/demo-instruct.wav
    restart: unless-stopped
  coturn:
    image: instrumentisto/coturn
    network_mode: "host"
    environment:
      - TURN_EXTERNAL_IP=195.133.198.89
      # - TURN_EXTERNAL_IP=127.0.0.1
      - TURN_PORT=3478          # ← TURN on 443/TCP
      - TURN_TLS_PORT=3478      # ← TLS TURN also on 443
      - TURN_USER=test
      - TURN_PASSWORD=secret
      - TURN_REALM=webrtc
      - LETS_ENCRYPT_DOMAIN=   # Leave empty for self-signed
    volumes:
      - ./turnserver.conf:/etc/turnserver.conf:ro 
    cap_add:
      - NET_ADMIN
    restart: unless-stopped